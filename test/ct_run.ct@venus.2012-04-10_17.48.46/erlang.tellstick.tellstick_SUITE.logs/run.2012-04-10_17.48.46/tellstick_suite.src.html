<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Module /Users/malotte/erlang/tellstick/test/tellstick_SUITE.erl</title>
<meta http-equiv="cache-control" content="no-cache">
<link rel="stylesheet" href="../../ct_default.css" type="text/css"></head>
<body>

<pre>
    1:<i>%%%-------------------------------------------------------------------</i>
    2:<i>%%% @author Malotte Westman Lönne &lt;malotte@malotte.net&gt;</i>
    3:<i>%%% @copyright (C) 2012, Marina Westman Lönne</i>
    4:<i>%%% @doc</i>
    5:<i>%%%</i>
    6:<i>%%% Created : 10 Apr 2012 by Malotte Westman Lönne</i>
    7:<i>%%% @end</i>
    8:<i>%%%-------------------------------------------------------------------</i>
    9:-<b>module</b>(tellstick_SUITE).
<a name="10"></a>   10:
   11:-<b>compile</b>(export_all).
   12:
   13:-<b>include_lib</b>("common_test/include/ct.hrl").
   14:
   15:<i>%%--------------------------------------------------------------------</i>
   16:<i>%% @spec suite() -&gt; Info</i>
   17:<i>%% Info = [tuple()]</i>
   18:<i>%% @end</i>
   19:<i>%%--------------------------------------------------------------------</i>
<a name=suite><a name="20"></a>   20:<b>suite</b></a>() -&gt;
   21:    [{timetrap,{seconds,30}}].
   22:
   23:<i>%%--------------------------------------------------------------------</i>
   24:<i>%% @spec all() -&gt; GroupsAndTestCases | {skip,Reason}</i>
   25:<i>%% GroupsAndTestCases = [{group,GroupName} | TestCase]</i>
   26:<i>%% GroupName = atom()</i>
   27:<i>%% TestCase = atom()</i>
   28:<i>%% Reason = term()</i>
   29:<i>%% @end</i>
<a name="30"></a>   30:<i>%%--------------------------------------------------------------------</i>
<a name=all>   31:<b>all</b></a>() -&gt; 
   32:    [start_tellstick,
   33:     turn_on_off].
   34:
   35:<i>%%--------------------------------------------------------------------</i>
   36:<i>%% @spec init_per_suite(Config0) -&gt;</i>
   37:<i>%%     Config1 | {skip,Reason} | {skip_and_save,Reason,Config1}</i>
   38:<i>%% Config0 = Config1 = [tuple()]</i>
   39:<i>%% Reason = term()</i>
<a name="40"></a>   40:<i>%% @end</i>
   41:<i>%%--------------------------------------------------------------------</i>
<a name=init_per_suite>   42:<b>init_per_suite</b></a>(Config) -&gt;
   43:    tellstick_node:init(),
   44:    tellstick_node:start(),
   45:    Config.
   46:
   47:<i>%%--------------------------------------------------------------------</i>
   48:<i>%% @spec end_per_suite(Config0) -&gt; void() | {save_config,Config1}</i>
   49:<i>%% Config0 = Config1 = [tuple()]</i>
<a name="50"></a>   50:<i>%% @end</i>
   51:<i>%%--------------------------------------------------------------------</i>
<a name=end_per_suite>   52:<b>end_per_suite</b></a>(_Config) -&gt;
   53:    tellstick_node:stop(),
   54:    ok.
   55:
   56:
   57:<i>%%--------------------------------------------------------------------</i>
   58:<i>%% @spec init_per_testcase(TestCase, Config0) -&gt;</i>
   59:<i>%%               Config1 | {skip,Reason} | {skip_and_save,Reason,Config1}</i>
<a name="60"></a>   60:<i>%% TestCase = atom()</i>
   61:<i>%% Config0 = Config1 = [tuple()]</i>
   62:<i>%% Reason = term()</i>
   63:<i>%% @end</i>
   64:<i>%%--------------------------------------------------------------------</i>
<a name=init_per_testcase>   65:<b>init_per_testcase</b></a>(_TestCase, Config) -&gt;
   66:    ct:pal("Testcase: ~p", [_TestCase]),
   67:    ConfFile = filename:join(?config(data_dir, Config), ct:get_config(conf)),
   68:    tellstick_srv:start_link([{debug, true}, 
   69:			      {linked, false},
<a name="70"></a>   70:			      {reset, true},
   71:			      {co_node, tellstick_node:serial()},
   72:			      {config, ConfFile}]),
   73:    %% Give tellstick time to reset
   74:    timer:sleep(1000),
   75:    Config.
   76:
   77:<i>%%--------------------------------------------------------------------</i>
   78:<i>%% @spec end_per_testcase(TestCase, Config0) -&gt;</i>
   79:<i>%%               void() | {save_config,Config1} | {fail,Reason}</i>
<a name="80"></a>   80:<i>%% TestCase = atom()</i>
   81:<i>%% Config0 = Config1 = [tuple()]</i>
   82:<i>%% Reason = term()</i>
   83:<i>%% @end</i>
   84:<i>%%--------------------------------------------------------------------</i>
<a name=end_per_testcase>   85:<b>end_per_testcase</b></a>(_TestCase, _Config) -&gt;
   86:    tellstick_srv:stop(),
   87:    ok.
   88:
   89:
<a name="90"></a>   90:<i>%%--------------------------------------------------------------------</i>
   91:<i>%% @spec start_tellstick() -&gt; ok</i>
   92:<i>%% @end</i>
   93:<i>%%--------------------------------------------------------------------</i>
<a name=start_tellstick>   94:<b>start_tellstick</b></a>(_Config) -&gt; 
   95:    %% Done in init_per_testcase()
   96:    timer:sleep(1000),
   97:    ok.
   98:
   99:<i>%%--------------------------------------------------------------------</i>
<a name="100"></a>  100:<i>%% @spec turn_on() -&gt; ok</i>
  101:<i>%% @end</i>
  102:<i>%%--------------------------------------------------------------------</i>
<a name=turn_on_off>  103:<b>turn_on_off</b></a>(_Config) -&gt;
  104:    %% Springback requires on and off
  105:    co_api:notify({xnodeid, ct:get_config(source_node)}, 
  106:		  pdo1_tx, 16#6000, 9, &lt;&lt;1:32/little&gt;&gt;),
  107:    timer:sleep(100),
  108:    co_api:notify({xnodeid, ct:get_config(source_node)}, 
  109:		  pdo1_tx, 16#6000, 9, &lt;&lt;0:32/little&gt;&gt;),
<a name="110"></a>  110:    %% How verify ??
  111:    timer:sleep(1000),
  112:    co_api:notify({xnodeid, ct:get_config(source_node)}, 
  113:		  pdo1_tx, 16#6000, 9, &lt;&lt;1:32/little&gt;&gt;),
  114:    timer:sleep(100),
  115:    co_api:notify({xnodeid, ct:get_config(source_node)}, 
  116:		  pdo1_tx, 16#6000, 9, &lt;&lt;0:32/little&gt;&gt;),
  117:    %% How verify ??
  118:    timer:sleep(1000),
  119:    ok.
<a name="120"></a>  120:
  121:<i>%%--------------------------------------------------------------------</i>
  122:<i>%% @spec turn_off() -&gt; ok</i>
  123:<i>%% @end</i>
  124:<i>%%--------------------------------------------------------------------</i>
<a name=turn_off>  125:<b>turn_off</b></a>(_Config) -&gt;
  126:    %% Springback requires on and off
  127:    ok.
  128:
  129:<i>%%--------------------------------------------------------------------</i>
<a name="130"></a>  130:<i>%% @spec break(Config) -&gt; ok </i>
  131:<i>%% @doc </i>
  132:<i>%% Dummy test case to have a test environment running.</i>
  133:<i>%% Stores Config in ets table.</i>
  134:<i>%% @end</i>
  135:<i>%%--------------------------------------------------------------------</i>
<a name=break>  136:<b>break</b></a>(Config) -&gt;
  137:    ets:new(config, [set, public, named_table]),
  138:    ets:insert(config, Config),
  139:    test_server:break("Break for test development\n" ++
<a name="140"></a>  140:		     "Get Config by ets:tab2list(config)"),
  141:    ok.
  142:
  143:
<a name=serial>  144:<b>serial</b></a>() -&gt;
  145:    tellstick_node:serial(). 
</pre>
</body>
</html>
